# 单词打卡功能部署说明

## 服务器信息
- 服务器IP: 124.220.224.91
- 后端路径: /www/wwwroot/pomodoro-api
- 前端路径: /www/wwwroot/pomodoro-frontend

## 方法一：使用部署脚本（推荐）

### 前提条件
需要安装 PuTTY 工具集（包含 pscp 和 plink）：
- 下载地址: https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html
- 或使用 Git Bash（包含 scp 和 ssh）

### 使用步骤

#### 如果使用 Git Bash:
```bash
cd /d/download
bash deploy.sh
```

#### 如果使用 PuTTY:
```cmd
cd D:\download
deploy.bat
```

输入服务器密码后，脚本会自动完成所有部署步骤。

---

## 方法二：手动部署

### 1. 上传后端文件

使用 WinSCP、FileZilla 或命令行工具上传以下文件：

#### 上传到 `/www/wwwroot/pomodoro-api/models/`
- D:\download\backend\models\word_record.go

#### 上传到 `/www/wwwroot/pomodoro-api/database/`
- D:\download\backend\database\db.go

#### 上传到 `/www/wwwroot/pomodoro-api/controllers/`
- D:\download\backend\controllers\word.go

#### 上传到 `/www/wwwroot/pomodoro-api/`
- D:\download\backend\main.go

### 2. 上传前端文件

#### 上传到 `/www/wwwroot/pomodoro-frontend/`
- D:\download\frontend\index.html

#### 上传到 `/www/wwwroot/pomodoro-frontend/js/`
- D:\download\frontend\js\config.js
- D:\download\frontend\js\words.js
- D:\download\frontend\js\app.js

#### 上传到 `/www/wwwroot/pomodoro-frontend/css/`
- D:\download\frontend\css\main.css

### 3. SSH 连接到服务器

使用 PuTTY 或终端连接：
```bash
ssh root@124.220.224.91
```

### 4. 重新编译后端

```bash
cd /www/wwwroot/pomodoro-api
go build -o pomodoro-api
```

如果编译成功，会显示没有错误信息。

### 5. 重启后端服务

#### 如果使用 systemd 管理服务：
```bash
systemctl restart pomodoro
systemctl status pomodoro
```

#### 如果是手动启动的进程：
```bash
# 停止旧进程
pkill -f pomodoro-api

# 启动新进程
cd /www/wwwroot/pomodoro-api
nohup ./pomodoro-api > pomodoro.log 2>&1 &

# 检查是否运行
ps aux | grep pomodoro-api
```

### 6. 检查数据库迁移

连接数据库查看是否创建了 word_records 表：
```bash
sqlite3 /www/wwwroot/pomodoro-api/pomodoro.db
.tables
.schema word_records
.quit
```

应该能看到 word_records 表。

### 7. 清除浏览器缓存

在浏览器中访问应用时：
- 按 `Ctrl + Shift + R` 强制刷新
- 或在开发者工具（F12）中清除缓存

---

## 方法三：使用 FTP 工具

### 推荐工具
- **FileZilla**: https://filezilla-project.org/
- **WinSCP**: https://winscp.net/

### 连接信息
- 协议: SFTP
- 主机: 124.220.224.91
- 端口: 22
- 用户名: root
- 密码: (您的服务器密码)

### 操作步骤
1. 连接到服务器
2. 按照"方法二"中的路径上传相应文件
3. 使用 WinSCP 或 FileZilla 的内置终端功能执行编译和重启命令

---

## 验证部署

### 1. 检查后端 API

在浏览器或使用 curl 测试：
```bash
curl http://124.220.224.91:8080/api/words/today \
  -H "Authorization: Bearer YOUR_TOKEN"
```

应该返回 JSON 格式的响应。

### 2. 检查前端页面

1. 访问应用网址
2. 登录账号
3. 点击"单词打卡"标签
4. 检查是否显示正常
5. 尝试提交一条记录

### 3. 功能测试

- ✅ 能否选择日期
- ✅ 能否输入单词数量
- ✅ 能否提交打卡
- ✅ 统计数据是否更新
- ✅ 历史记录是否显示
- ✅ 能否删除记录

---

## 常见问题

### Q1: 编译失败
**原因**: 缺少依赖或 Go 版本不兼容
**解决**:
```bash
cd /www/wwwroot/pomodoro-api
go mod tidy
go build -o pomodoro-api
```

### Q2: 服务重启失败
**检查日志**:
```bash
journalctl -u pomodoro -n 50
# 或
tail -f /www/wwwroot/pomodoro-api/pomodoro.log
```

### Q3: 前端显示异常
**解决**:
- 强制刷新浏览器 (Ctrl + Shift + R)
- 检查浏览器控制台错误 (F12)
- 确认文件上传成功

### Q4: API 请求失败
**检查**:
- 后端服务是否运行
- 防火墙是否开放 8080 端口
- CORS 配置是否正确

### Q5: 数据库迁移未执行
**手动迁移**:
```bash
# 服务启动时会自动执行 AutoMigrate
# 如果没有，重启服务即可
systemctl restart pomodoro
```

---

## 回滚操作

如果部署后出现问题，可以恢复到之前的版本：

### 恢复后端
```bash
cd /www/wwwroot/pomodoro-api
git checkout HEAD -- models/word_record.go database/db.go controllers/word.go main.go
go build -o pomodoro-api
systemctl restart pomodoro
```

### 恢复前端
从备份中恢复相应文件，或重新部署之前的版本。

---

## 技术支持

如遇到问题，请检查：
1. 服务器日志: `/www/wwwroot/pomodoro-api/pomodoro.log`
2. 系统日志: `journalctl -u pomodoro`
3. 浏览器控制台: F12 查看错误信息
4. 网络请求: F12 Network 标签查看 API 请求

---

## 新功能说明

### 单词打卡功能包含：

#### 提交打卡
- 选择日期（默认今天）
- 输入单词数量
- 添加备注（可选）
- 同一天重复提交会更新记录

#### 统计数据
- 累计单词：总共背过的单词数
- 打卡天数：有记录的天数
- 日均单词：平均每天的单词数

#### 历史记录
- 按时间倒序显示
- 显示日期、单词数、备注
- 可以删除记录
- 支持无限滚动加载

#### 日期显示
- 今天：显示"今天"
- 昨天：显示"昨天"
- 其他：显示"YYYY-MM-DD 周X"

---

**部署时间**: 预计 5-10 分钟
**难度**: ⭐⭐☆☆☆

祝部署顺利！🎉
